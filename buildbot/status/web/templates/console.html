{% extends "layout.html" %}

{% block head %}
{{ super() }}
<script type='text/javascript'>
// <;![Cdata[
//

//
// Functions used to display the build status bubble on box click.
//

// show the build status box. This is called when the user clicks on a block.
function showBuildBox(url, event) {
    //  Find the current curson position.
    var cursorPosTop = (window.event ? window.event.clientY : event.pageY)
    var cursorPosLeft = (window.event ? window.event.clientX : event.pageX)

    // Offset the position by 5, to make the window appears under the cursor.
    cursorPosTop  = cursorPosTop  + document.body.scrollTop -5 ;    
    cursorPosLeft = cursorPosLeft  + document.body.scrollLeft - 5;

    // Move the div (hidden) under the cursor.
    var divBox = document.getElementById('divBox');
    divBox.style.top = parseInt(cursorPosTop) + 'px';
    divBox.style.left = parseInt(cursorPosLeft) + 'px';

    // Reload the hidden frame with the build page we want to show.
    // The onload even on this frame will update the div and make it visible.
    document.getElementById("frameBox").src = url
    
    // We don't want to reload the page.
    return false;
}

// OnLoad handler for the iframe containing the build to show.
function updateDiv(event) { 
    // Get the frame innerHTML.
    var iframeContent = document.getElementById("frameBox").contentWindow.document.body.innerHTML;

    // If there is any content, update the div, and make it visible.
    if (iframeContent) {
        var divBox = document.getElementById('divBox'); 
        divBox.innerHTML = iframeContent ;
        divBox.style.display = "block";
    }
} 

// Util functions to know if an element is contained inside another element.
// We use this to know when we mouse out our build status div.
function containsDOM (container, containee) {
    var isParent = false;
    do {
        if ((isParent = container == containee))
            break;
        containee = containee.parentNode;
    } while (containee != null);

    return isParent;
}

// OnMouseOut handler. Returns true if the mouse moved out of the element.
// It is false if the mouse is still in the element, but in a blank part of it,
// like in an empty table cell.
function checkMouseLeave(element, event) {
  if (element.contains && event.toElement) {
    return !element.contains(event.toElement);
  }
  else if (event.relatedTarget) {
    return !containsDOM(element, event.relatedTarget);
  }
}
// ]]> 
</script>
{% endblock %}

{% block content %}
<div align="center">
  <table width=95% class="Grid" border="0" cellspacing="0">
    <tr>
      <td width=33% align=left class=left_align><a href="{{ project_url }}">{{ project_name }}</a>
        {% if categories %}
          <br><b>Categories:</b> {{ categories }}
        {% endif %}
        {% if branch != ANYBRANCH %}
          <br><b>Branch:</b> {{ branch }}
        {% endif %}
      </td>
      <td width=33% align=center class=center_align>
        <div align="center">
          <table>
            <tr>
              <td>Legend:&nbsp;&nbsp;</td>
              <td><div class='legend success' title='All tests passed'>Passed</div></td>
              <td><div class='legend failure' title='There is a new failure. Take a look!'>Failed</div></td>
              <td><div class='legend warnings' title='It was failing before, and it is still failing. Make sure you did not introduce new regressions'>Failed Again</div></td>
              <td><div class='legend running' title='The tests are still running'>Running</div></td>
              <td><div class='legend exception' title='Something went wrong with the test, there is no result'>Exception</div></td>
              <td><div class='legend notstarted' title='No result yet.'>No data</div></td>
            </tr>
          </table>
        </div>
      </td>
      <td width=33% align=right class=right_align>
        <script>
          function reload_page() {
            name_value = document.getElementById('namebox').value
            if (document.location.href.lastIndexOf('?') == -1)
              document.location.href = document.location.href+ '?name=' + name_value;
            else
              document.location.href = document.location.href+ '&name=' + name_value;
          }
        </script>
        <input id='namebox' name='name' type='text' style='color:#999;'
            onblur='this.value = this.value || this.defaultValue; this.style.color = "#999";'
            onfocus='this.value=""; this.style.color = "#000";'
            value='Personalized for...'>
      
        <input type=submit value='Go' onclick='reload_page()'>
      </td>
     </tr>
  </table>
</div>
<br>
<div align="center">
  <table width=96%>
    {{ content }} 
  </table>
</div>
<div id="divBox" OnMouseOut="if (checkMouseLeave(this, event)) this.style.display = 'None'" class="BuildWaterfall"> 
</div>
<iframe id="frameBox" style="display: none;" onload="updateDiv(event);"></iframe>
  
{% endblock %}

{% block footer %}
{{ super() }}
<p>Debug info: {{ debuginfo }}</p>
{% endblock %}
