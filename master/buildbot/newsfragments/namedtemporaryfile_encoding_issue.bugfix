Fix encoding problem of :py:class:`~NamedTemporaryFile` and add related unittest (:issue:`3799`).
